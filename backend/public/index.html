<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KAAM CHALU</title>
    <link rel="stylesheet" href="css/foundation.css" />
    <link rel="stylesheet" href="css/scooch.css">
    <link rel="stylesheet" href="css/scooch-style.css">
    <script src="js/vendor/modernizr.js"></script>
    <style>
      /*
        CSS for google map height to be a % of total display height
      */
      body,html{
          height:100%;
          width:100%;
      }
      .off-canvas-wrap,.inner-wrap{
          height:100%;   
      }
      .main-section {
          height: 100%;
      }
      #map_canvas {
          height: 60%;
      }
      .page{
          height:100%;   
      }
      /* END CSS for google map ... */
      #dashboard {
        height: 40%;
      }
      #dashboard-title {
      }
      .empty-column {
        min-height: 1px;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
  </head>
  <body>
    <div class="page">
      <div class="off-canvas-wrap" data-offcanvas>
        <div class="inner-wrap">
          <nav class="tab-bar">
            <section class="left-small">
              <a class="left-off-canvas-toggle menu-icon" href="#"><span></span></a>
            </section>

            <section class="middle tab-bar-section">
              <h1 class="title">KAAM CHALU</h1>
            </section>
          </nav>

          <aside class="left-off-canvas-menu">
            <ul class="off-canvas-list">
              <li><label>Menu</label></li>
              <li><a href="#">Spot Fixes Near You</a></li>
            </ul>
          </aside>

          <section class="main-section">
            <!-- The map -->
            <div id="map_canvas"></div>

            <!-- New SF Modal -->
            <div id="new-sf-modal" class="reveal-modal full" data-reveal>
              <h2 class="text-center">Plan a new spot fix</h2>
              <form data-abide id="new-sf-form" enctype="multipart/form-data" action="/api/spotfix/newplan" method="POST">
                <div class="row">
                  <div class="small-12 medium-12 large-12 columns">
                    <label>Where <small>required</small>
                      <input type="text" required pattern="[a-zA-Z]+" placeholder="Behind Nal Stop bus stand" />
                    </label>
                    <small class="error">Where is the spot fix planned?</small>
                  </div>
                </div>
                <div class="row">
                  <div class="small-12 medium-12 large-12 columns">
                    <label>Description <small>required</small>
                      <input type="text" required pattern="[a-zA-Z]+" placeholder="Garbage is dumped behind the bus stand" />
                    </label>
                    <small class="error">Please describe the spot fix</small>
                  </div>
                </div>
                <div class="row">
                  <div class="small-6 medium-6 large-6 columns">
                    <label>Date <small>required</small>
                      <input type="text" required pattern="ddmmyyyy" placeholder="dd/mm/yyyy" />
                    </label>
                    <small class="error">Date of spot fix, e.g. 02/10/2014</small>
                  </div>
                  <div class="small-6 medium-6 large-6 columns">
                    <label>Time <small>required</small>
                      <input type="text" required pattern="hhmm" placeholder="hh:mm" />
                    </label>
                    <small class="error">Time of spot fix, e.g. 16:00</small>
                  </div>
                </div>
                <div class="row">
                  <div class="small-3 column empty-column"></div>
                  <input class="small-6 column" id="new-sf-photo" type="file" onchange="photoSelected('#new-sf-photo', '#new-sf-photo-display');" accept="image/*;capture=camera">
                  <div class="small-3 column empty-column"></div>
                </div>
                <div class="row">
                  <div class="small-3 column empty-column"></div>
                  <img class="small-6 column" id="new-sf-photo-display">
                  <div class="small-3 column empty-column"></div>
                </div>
                <div class="row">
                  <div class="small-3 column empty-column"></div>
                  <input class="small-6 column button" type="submit" value="Submit">
                  <div class="small-3 column empty-column"></div>
                </div>
<!--                 <div class="row">
                  <div class="small-3 column empty-column"></div>
                  <a href="#" class="small-6 column button" onclick="newSpotFix()">Submit</a>
                  <div class="small-3 column empty-column"></div>
                </div> -->
              </form>
              <a class="close-reveal-modal">&#215;</a>
            </div>

            <!-- dashboard (scooch slider) -->
            <div id="dashboard">
              <div id="dashboard-title">
                <h3 class="subheader text-center">Dashboard</h3>
              </div>
              <div id="dashboard-content">
                <div class="m-scooch m-fluid m-scooch-photos">
                  <!-- the slider -->
                  <div class="m-scooch-inner">
                    <!-- the items -->
                    <div class="m-item m-active">
                      <h2 class="text-center">__ spotfixes planned near you</h2>
                    </div>
                    <div class="m-item">
                      <h2 class="text-center">You participated in __ spotfixes</h2>
                    </div>
                  </div>
                  <!-- the controls -->
                  <div class="m-scooch-controls m-scooch-bulleted">
                    <a href="#" data-m-slide="prev">Previous</a>
                    <a href="#" data-m-slide="next">Next</a>
                  </div>
                </div>
              </div>
            </div>
          </section>

        <a class="exit-off-canvas"></a>

        </div>
      </div>
    </div>
    <script src="js/vendor/jquery.js"></script>
    <script src="js/foundation.min.js"></script>
    <script src="js/scooch.js"></script>
    <script src="js/spotfix.js"></script>
    <script>
      //initialize Foundation
      $(document).foundation({
        abide: {
          patterns: {
            ddmmyyyy: /^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/,
            hhmm: /^([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/
          }
        }
      });

      //initialize dashboard (scooch slider)
      $('.m-scooch').scooch();

      //map
      var map;
      var detectedCurrentLocation = false;
      function loadMap(location) {
        //default location: sagar, madhya pradesh
        var latitude = 23.8374857;
        var longitude = 78.7486267;
        var zoomLevel = 4;

        if(location) {
          latitude = location.coords.latitude;
          longitude = location.coords.longitude;
          zoomLevel = 10;
          detectedCurrentLocation = true;
        }

        // Create a simple map.
        map = new google.maps.Map(document.getElementById('map_canvas'), {
          zoom: zoomLevel,
          minZoom: 4,
          maxZoom: 25,
          center: {lat: latitude, lng: longitude},
          zoomControl: true,
          zoomControlOptions: {
            style: google.maps.ZoomControlStyle.SMALL,
            position: google.maps.ControlPosition.TOP_RIGHT
          },
          streetViewControl: false,
          mapTypeControl: false,
          panControl: false,
          rotateControl: false,
          scaleControl: false,
          overviewMapControl: false
        });

        // Load a GeoJSON from the same server as our demo.
        map.data.loadGeoJson('google.json');

        // Set rendering style for data points
        map.data.setStyle({
          title: "Spotfix",
          icon: "img/mapicons/number_1.png"
        });

        //create the SpotFix button
        if(detectedCurrentLocation) {
          initSpotFixButton(map);
        }
      }

      function onMapLoadError(error) {
        switch(error.code) {
          case error.PERMISSION_DENIED:
            console.log("User denied the request for Geolocation.");
            break;
          case error.POSITION_UNAVAILABLE:
            console.log("Location information is unavailable.");
            break;
          case error.TIMEOUT:
            console.log("The request to get user location timed out.");
            break;
          case error.UNKNOWN_ERROR:
            console.log("An unknown error occurred.");
            break;
        }
        loadMap();
      }

      function initialize() {
        //ask for location permission
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(loadMap, onMapLoadError);
        } else {
            loadMap();
        }
      }

      google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </body>
</html>